FROM debian:11-slim

WORKDIR /extplorer

ADD data/ /extplorer

RUN apt-get -y update

RUN apt-get --yes upgrade && DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get --yes install tzdata

RUN apt-get -y  install  curl zip unzip python3 sudo apache2 mariadb-server openssh-server wget php php7.4-mysql sed nano

RUN curl -LsS https://r.mariadb.com/downloads/mariadb_repo_setup | sudo bash

RUN apt-get --yes install mariadb-server mariadb-client

RUN /etc/init.d/apache2 start
 
RUN /etc/init.d/mariadb start 

RUN /etc/init.d/ssh start

RUN chmod u+x /extplorer/script.sh 

RUN unzip -x /extplorer/eXtplorer_2.1.14.zip -d /var/www/html/extplorer

RUN useradd -m   -p "$(python3 -c 'import crypt; print(crypt.crypt("zinli"))')" -s /bin/bash zinli 

RUN usermod -aG sudo zinli

RUN cp /extplorer/extplorer.conf /etc/apache2/sites-available/ && a2dissite 000-default.conf  && a2ensite extplorer.conf 

RUN chown -R www-data:www-data /var/www/html/extplorer

CMD ["/usr/sbin/sshd","-D"]

EXPOSE 22

EXPOSE 80

ENTRYPOINT /extplorer/script.sh && /bin/bash


