FROM ubuntu:20.04

WORKDIR /catchthemes

ADD data/ /catchthemes 

RUN apt-get update --yes

RUN apt-get --yes upgrade && DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get --yes install tzdata

RUN apt-get --yes install curl sudo php zip unzip apache2 mariadb-server openssh-server php7.4-mysql

RUN apt-get install --yes apache2

RUN curl -LsS https://r.mariadb.com/downloads/mariadb_repo_setup | sudo bash

RUN apt-get --yes install mariadb-server mariadb-client

RUN apt-get --yes install python3

RUN /etc/init.d/apache2 start

RUN /etc/init.d/mariadb start

RUN /etc/init.d/ssh start

RUN chmod u+x /catchthemes/script.sh

RUN unzip -x /catchthemes/wordpress-5.6.6.zip -d /var/www/html

RUN unzip -x /catchthemes/catch-themes-demo-import.1.6.1.zip -d /var/www/html/wordpress/wp-content/plugins

RUN unzip -x /catchthemes/paid-memberships-pro.2.9.7.zip -d /var/www/html/wordpress/wp-content/plugins

RUN useradd -m   -p "$(python3 -c 'import crypt; print(crypt.crypt("loyd"))')" -s /bin/bash loyd 

RUN usermod -aG sudo loyd

RUN cp /catchthemes/wp-config.php /var/www/html/wordpress

RUN chown -R www-data:www-data /var/www/html/wordpress

CMD ["/usr/sbin/sshd","-D"]

EXPOSE 22

EXPOSE 80

ENTRYPOINT /catchthemes/script.sh && /bin/bash



